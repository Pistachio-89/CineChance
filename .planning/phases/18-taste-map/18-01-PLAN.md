---
phase: 18-taste-map
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/api/user/taste-map/route.ts
  - src/app/profile/components/ProfileOverviewClient.tsx
autonomous: true
requirements: []

must_haves:
  truths:
    - "User can see Taste Map card on profile page"
    - "Card links to /profile/taste-map"
    - "API returns cached taste map data for authenticated users"
  artifacts:
    - path: "src/app/api/user/taste-map/route.ts"
      provides: "GET endpoint for taste map data"
      exports: ["GET"]
    - path: "src/app/profile/components/ProfileOverviewClient.tsx"
      provides: "Profile page card for Taste Map"
      contains: "Карта вкуса"
  key_links:
    - from: "src/app/profile/components/ProfileOverviewClient.tsx"
      to: "/profile/taste-map"
      via: "Link href"
      pattern: "href=\"/profile/taste-map\""
---

<objective>
Create API endpoint for taste map data and add profile card linking to detailed taste map page.
</objective>

<context>
@.planning/phases/18-taste-map/18-RESEARCH.md
@src/lib/taste-map/redis.ts
@src/lib/taste-map/compute.ts
@src/app/profile/components/ProfileOverviewClient.tsx
@src/app/api/user/stats/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Taste Map API endpoint</name>
  <files>src/app/api/user/taste-map/route.ts</files>
  <action>
Create GET /api/user/taste-map endpoint following the pattern from /api/user/stats/route.ts:
1. Add rate limiting using rateLimit(request, '/api/user/taste-map')
2. Add getServerSession(authOptions) auth check
3. Import getTasteMap from '@/lib/taste-map/redis'
4. Import computeTasteMap from '@/lib/taste-map/compute'
5. Use getTasteMap(userId, () => computeTasteMap(userId)) to get cached data
6. Return NextResponse.json with taste map data or { empty: true } if null
7. Add proper error handling with logger
  </action>
  <verify>File created with valid TypeScript, no lint errors</verify>
  <done>GET /api/user/taste-map returns 200 with taste map data for authenticated users</done>
</task>

<task type="auto">
  <name>Task 2: Add Taste Map card to Profile page</name>
  <files>src/app/profile/components/ProfileOverviewClient.tsx</files>
  <action>
Add Taste Map card to ProfileOverviewClient.tsx after the existing cards section (before the invite button):
1. Import Map icon from lucide-react
2. Add Link component with href="/profile/taste-map"
3. Use existing card styling pattern (bg-gray-900, rounded-lg, border-gray-800, hover states)
4. Use purple gradient theme for visual distinction
5. Card text: "Карта вкуса" / "Ваши предпочтения в фильмах"
6. Follow the exact pattern of existing Link cards in the component
  </action>
  <verify>npm run lint passes</verify>
  <done>Taste Map card appears in profile page linking to /profile/taste-map</done>
</task>

</tasks>

<verification>
- [ ] API endpoint created at /api/user/taste-map
- [ ] API returns 401 for unauthenticated requests
- [ ] API returns 429 for rate-limited requests
- [ ] API returns taste map data with 24h cache
- [ ] Profile page shows Taste Map card
- [ ] Card links to /profile/taste-map
</verification>

<success_criteria>
- API endpoint functional at GET /api/user/taste-map
- Profile page displays clickable Taste Map card
- Card navigates to /profile/taste-map
</success_criteria>

<output>
After completion, create `.planning/phases/18-taste-map/18-01-SUMMARY.md`
</output>
