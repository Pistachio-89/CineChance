---
phase: 18-taste-map
plan: "02"
type: execute
wave: 2
depends_on:
  - "18-01"
files_modified:
  - src/app/profile/taste-map/page.tsx
  - src/app/profile/taste-map/TasteMapClient.tsx
autonomous: true
requirements: []

must_haves:
  truths:
    - "User can view detailed taste map at /profile/taste-map"
    - "Genre profile displayed as horizontal bar chart"
    - "Rating distribution displayed as pie chart"
    - "Top actors and directors shown as chips"
  artifacts:
    - path: "src/app/profile/taste-map/page.tsx"
      provides: "Server Component for taste map page"
      exports: ["default function"]
    - path: "src/app/profile/taste-map/TasteMapClient.tsx"
      provides: "Client Component with visualizations"
      contains: "Recharts"
  key_links:
    - from: "src/app/profile/taste-map/page.tsx"
      to: "@/lib/taste-map/redis"
      via: "import getTasteMap"
      pattern: "getTasteMap.*computeTasteMap"
    - from: "src/app/profile/taste-map/TasteMapClient.tsx"
      to: "recharts"
      via: "import"
      pattern: "BarChart.*PieChart"
---

<objective>
Create detailed Taste Map page with visualizations using Recharts.
</objective>

<context>
@.planning/phases/18-taste-map/18-RESEARCH.md
@src/lib/taste-map/types.ts
@src/lib/taste-map/redis.ts
@src/app/profile/stats/page.tsx
@src/app/profile/components/ProfileOverviewClient.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Taste Map page (Server Component)</name>
  <files>src/app/profile/taste-map/page.tsx</files>
  <action>
Create server-side page at src/app/profile/taste-map/page.tsx:
1. Add 'use client' directive (needed for auth check in Next.js 16)
2. Import getServerSession from 'next-auth', authOptions from '@/auth'
3. Import getTasteMap and computeTasteMap from '@/lib/taste-map'
4. Import TasteMapClient from './TasteMapClient'
5. Add authentication check - redirect to sign-in if not authenticated
6. Fetch taste map using getTasteMap(userId, () => computeTasteMap(userId))
7. Pass tasteMap data to TasteMapClient component
8. Handle empty state (user with no watched movies)
9. Follow page layout pattern from /profile/stats/page.tsx
  </action>
  <verify>File created with valid TypeScript, no lint errors</verify>
  <done>Page renders and fetches taste map data server-side</done>
</task>

<task type="auto">
  <name>Task 2: Create Taste Map visualizations (Client Component)</name>
  <files>src/app/profile/taste-map/TasteMapClient.tsx</files>
  <action>
Create client component at src/app/profile/taste-map/TasteMapClient.tsx with visualizations:
1. Add 'use client' at top
2. Import types from '@/lib/taste-map/types'
3. Import Recharts components: BarChart, Bar, XAxis, YAxis, ResponsiveContainer, Tooltip, PieChart, Pie, Cell, Legend
4. Create section for Genre Profile (horizontal bar chart - top 10 genres)
5. Create section for Rating Distribution (pie chart with high/medium/low)
6. Create section for Top Actors (chips/tags with amber styling)
7. Create section for Top Directors (chips/tags with blue styling)
8. Create section for Type Breakdown (movie vs tv percentages)
9. Create section for Computed Metrics (positive/negative intensity, consistency, diversity)
10. Add proper empty state handling with helpful message
11. Use Tailwind styling matching existing profile components
12. Use dark theme colors from existing project (gray-900, purple-500, etc.)
  </action>
  <verify>npm run lint passes</verify>
  <done>Taste Map page displays all visualizations with real data</done>
</task>

</tasks>

<verification>
- [ ] /profile/taste-map page exists and loads
- [ ] Genre profile shows as horizontal bar chart (top 10 genres)
- [ ] Rating distribution shows as pie chart
- [ ] Top actors shown as chips
- [ ] Top directors shown as chips
- [ ] Type breakdown displayed
- [ ] Empty state handled gracefully
</verification>

<success_criteria>
- Complete Taste Map page functional at /profile/taste-map
- All visualizations render with real data
- Page follows project design patterns
</success_criteria>

<output>
After completion, create `.planning/phases/18-taste-map/18-02-SUMMARY.md`
</output>
