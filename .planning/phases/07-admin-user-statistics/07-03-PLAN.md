---
phase: 07-admin-user-statistics
plan: '03'
type: execute
wave: 2
depends_on:
  - '07-01'
autonomous: true
requirements: []
must_haves:
  truths:
    - Admin can click user row to view their stats
    - User stats page shows same blocks as profile/stats
    - Stats include filtering by content type
  artifacts:
    - path: src/app/admin/users/[userId]/stats/page.tsx
      provides: Individual user statistics page
      contains: same sections as profile/stats
---

<objective>
Create user statistics page at /admin/users/[userId]/stats mirroring profile/stats functionality.

Purpose: Admin needs to view any user's statistics - watched movies, ratings, activity.

Output: New page with stats blocks (similar to profile/stats): total counts, content type breakdown, tags, genres, rating distribution.
</objective>

<context>
@src/app/profile/stats/StatsClient.tsx (pattern to follow)
@src/app/profile/stats/page.tsx (pattern to follow)
@src/app/api/user/stats/route.ts (reuse existing API)
</context>

<tasks>

<task type="auto">
  <name>Create user stats page route</name>
  <files>src/app/admin/users/[userId]/stats/page.tsx</files>
  <action>
Create new route: /admin/users/[userId]/stats

Follow profile/stats pattern:
1. Use existing /api/user/stats endpoint (may need admin version)
2. Copy StatsClient component structure
3. Show same blocks: content type cards, total stats, rating distribution
4. Add navigation back to user list
5. Get userId from URL params
</action>
  <verify>Page loads, displays stats for selected user</verify>
  <done>User stats page exists and shows data</done>
</task>

<task type="auto">
  <name>Add navigation from user list to stats</name>
  <files>src/app/admin/users/page.tsx</files>
  <action>
Make user rows clickable:
1. Click on user row navigates to /admin/users/[userId]/stats
2. Or add "View Stats" button in each row
3. Include user ID in the navigation
</action>
  <verify>Clicking user navigates to their stats page</verify>
  <done>Admin can navigate from list to individual stats</done>
</task>

<task type="auto">
  <name>Ensure stats page has filtering</name>
  <files>src/app/admin/users/[userId]/stats/page.tsx</files>
  <action>
Add content type filtering to user stats:
1. Copy content type cards (Фильмы, Сериалы, Мультфильмы, Аниме) from profile/stats
2. Reuse same API filtering logic
3. When clicking card, filter stats by that content type
</action>
  <verify>Clicking content type cards filters displayed stats</verify>
  <done>User stats page has content type filtering</done>
</task>

</tasks>

<verification>
- [ ] User stats page exists at /admin/users/[userId]/stats
- [ ] Displays same blocks as profile/stats
- [ ] Clicking user in list navigates to stats
- [ ] Content type filtering works
- [ ] Back navigation works
</verification>

<success_criteria>
Admin can view detailed statistics for any user, similar to profile/stats.
</success_criteria>

<output>
After completion, create `.planning/phases/07-admin-user-statistics/07-03-SUMMARY.md`
</output>
