---
phase: 04-animation-filter
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/recommendation-types.ts
  - src/app/recommendations/FilterForm.tsx
  - src/app/api/recommendations/random/route.ts
autonomous: true
requirements:
  - ANIM-01

must_haves:
  truths:
    - "User can see 'Мульт' filter button on Recommendations page"
    - "User can toggle the animation filter on/off"
    - "Animation filter works correctly with other active filters (movie, tv, anime)"
    - "When animation filter is ON, recommendations include animated content"
    - "When animation filter is OFF, recommendations exclude animated content"
  artifacts:
    - path: "src/lib/recommendation-types.ts"
      provides: "ContentType type definition with cartoon support"
      contains: "ContentType = 'movie' | 'tv' | 'anime' | 'cartoon'"
    - path: "src/lib/recommendation-types.ts"
      provides: "FiltersSnapshot interface with cartoon boolean"
      contains: "cartoon: boolean"
    - path: "src/app/recommendations/FilterForm.tsx"
      provides: "Animation filter button in UI"
      exports: ["handleTypeToggle for cartoon"]
    - path: "src/app/api/recommendations/random/route.ts"
      provides: "API validation for cartoon type"
      contains: "['movie', 'tv', 'anime', 'cartoon']"
  key_links:
    - from: "src/app/recommendations/FilterForm.tsx"
      to: "src/lib/recommendation-types.ts"
      via: "ContentType import"
      pattern: "import.*ContentType.*recommendation-types"
    - from: "src/app/recommendations/FilterForm.tsx"
      to: "/api/recommendations/random"
      via: "onSubmit callback with selectedTypes"
      pattern: "onSubmit.*selectedTypes.*cartoon"
    - from: "src/app/api/recommendations/random/route.ts"
      to: "src/lib/recommendation-types.ts"
      via: "ContentType import"
      pattern: "import.*ContentType.*recommendation-types"
---

<objective>
Add "Мульт" (Animation) content type filter button to the Recommendations page.

Purpose: Allow users to filter recommendations to include or exclude animated content (cartoons/animations that are not anime).

Output: Working animation filter that integrates with existing filter system.
</objective>

<execution_context>
@C:/Users/n0rds/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/n0rds/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/04-animation-filter/04-CONTEXT.md
@src/app/my-movies/FilmFilters.tsx
@src/app/recommendations/FilterForm.tsx
@src/lib/recommendation-types.ts
@src/app/api/recommendations/random/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update ContentType type and FiltersSnapshot</name>
  <files>src/lib/recommendation-types.ts</files>
  <action>
    1. Add 'cartoon' to ContentType union type (line 7):
       Change: `export type ContentType = 'movie' | 'tv' | 'anime';`
       To: `export type ContentType = 'movie' | 'tv' | 'anime' | 'cartoon';`

    2. Add cartoon boolean to FiltersSnapshot interface (lines 18-22):
       Change:
         contentTypes: {
           movie: boolean;
           tv: boolean;
           anime: boolean;
         };
       To:
         contentTypes: {
           movie: boolean;
           tv: boolean;
           anime: boolean;
           cartoon: boolean;
         };
  </action>
  <verify>
    - ContentType now includes 'cartoon' as valid type
    - FiltersSnapshot.contentTypes has cartoon: boolean
  </verify>
  <done>
    ContentType type accepts 'cartoon' value, FiltersSnapshot includes cartoon boolean field
  </done>
</task>

<task type="auto">
  <name>Task 2: Add "Мульт" button to FilterForm</name>
  <files>src/app/recommendations/FilterForm.tsx</files>
  <action>
    1. Update initialTypes default (line 45) to include 'cartoon':
       Change: `initialTypes = ['movie', 'tv', 'anime'],`
       To: `initialTypes = ['movie', 'tv', 'anime', 'cartoon'],`

    2. Add "Мульт" button after the "Аниме" button (after line 241), using identical styling:
       - Copy the "Аниме" button structure
       - Replace 'anime' with 'cartoon' 
       - Use orange gradient styling (like FilmFilters.tsx for cartoon)
       - Button text: "Мульт"

    The button should follow the same pattern as existing buttons:
    - type="button"
    - onClick={() => handleTypeToggle('cartoon')}
    - Same className structure with gradient background when selected
    - Orange color scheme: rgba(249, 115, 22) to rgba(234, 88, 12)
  </action>
  <verify>
    - FilterForm renders "Мульт" button alongside other content type buttons
    - Clicking button toggles cartoon in selectedTypes
  </verify>
  <done>
    "Мульт" button appears on Recommendations page, toggles correctly with other filters
  </done>
</task>

<task type="auto">
  <name>Task 3: Update API to accept cartoon type</name>
  <files>src/app/api/recommendations/random/route.ts</files>
  <action>
    Update filter validation in parseFilterParams function (line 88):
    
    Change:
      types = requestedTypes.filter(t => ['movie', 'tv', 'anime'].includes(t));
    
    To:
      types = requestedTypes.filter(t => ['movie', 'tv', 'anime', 'cartoon'].includes(t));
  </action>
  <verify>
    - API accepts 'cartoon' in types query parameter
    - No validation errors when cartoon is passed
  </verify>
  <done>
    Recommendations API correctly processes cartoon content type filter
  </done>
</task>

</tasks>

<verification>
- Build succeeds without errors
- No TypeScript errors related to ContentType or FiltersSnapshot
- Filter button appears and functions correctly
</verification>

<success_criteria>
- [ ] "Мульт" button visible on Recommendations page
- [ ] Button toggles on/off with correct styling
- [ ] Filter works with movie, tv, anime filters simultaneously
- [ ] API accepts cartoon type parameter
- [ ] Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-animation-filter/04-01-SUMMARY.md`
</output>
