---
phase: 06-stats-page
plan: '02'
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/profile/stats/StatsClient.tsx
autonomous: true
requirements: []
gap_closure: true
must_haves:
  truths:
    - Card labels match /profile page (Фильмы, Сериалы, Мультфильмы, Аниме)
    - Cards are clickable buttons (not Links) that toggle filter on stats page
    - Clicking a type filters the displayed stats data
    - Page loads with all types active (showing all data)
    - Click on inactive type enables it and disables others
    - Click on active type disables it (returns to all active)
  artifacts:
    - path: src/app/profile/stats/StatsClient.tsx
      provides: Stats page with filterable type cards
      contains: typeFilter state, onClick handlers, filtered data display
  key_links:
    - from: StatsClient.tsx
      to: /api/user/stats
      via: fetch in useEffect (need to pass typeFilter to API)
---

<objective>
Enhance stats page type cards with filtering functionality.

Purpose: 
1. Fix labels to match /profile (Мультфильмы instead of Мульты)
2. Convert cards from Links to buttons
3. Add filter toggle behavior - clicking a card filters stats by that content type
4. Implement toggle logic: all active → single selected → all disabled → all active

Output: Updated StatsClient.tsx with interactive filter cards.
</objective>

<context>
@src/app/profile/components/ProfileStats.tsx (lines 126-175 - reference for correct labels)
@src/app/profile/stats/StatsClient.tsx (file to modify)
</context>

<tasks>

<task type="auto">
  <name>Fix card labels and convert to interactive buttons</name>
  <files>src/app/profile/stats/StatsClient.tsx</files>
  <action>
Make these changes to StatsClient.tsx:

1. Add typeFilter state (after other state declarations):
   - const [typeFilter, setTypeFilter] = useState<string | null>(null);

2. Fix label from "Мульты" to "Мультфильмы" (line 275)

3. Convert Link to button for each card (replace lines 245-290):
   - Remove href from Link
   - Change <Link to <button with onClick handler
   - Add onClick={() => setTypeFilter('movie')} for Фильмы
   - Add onClick={() => setTypeFilter('tv')} for Сериалы
   - Add onClick={() => setTypeFilter('cartoon')} for Мультфильмы
   - Add onClick={() => setTypeFilter('anime')} for Аниме
   - Toggle logic: if clicking active filter, set to null (show all)

4. Add visual active state styling:
   - If typeFilter is null: all cards show default style
   - If typeFilter matches card type: highlight with brighter border (e.g., border-purple-500)
   - If typeFilter is set but doesn't match card: dimmed (opacity-50)

5. Use typeFilter in API call - need to fetch filtered data:
   - Currently fetches /api/user/stats (all data)
   - Either: add ?media= parameter to API call, OR
   - Filter the displayed data client-side if API doesn't support filtering
   - Check if API supports filtering first

The toggle logic:
- typeFilter === null (all showing) → click "movie" → typeFilter = "movie"
- typeFilter = "movie" → click "movie" → typeFilter = null (all)
- typeFilter = "movie" → click "tv" → typeFilter = "tv"
  </action>
  <verify>
Check that StatsClient.tsx has:
- typeFilter state
- Button onClick handlers for each card
- Toggle logic implemented
- Visual active/inactive states
  </verify>
  <done>StatsClient.tsx has interactive filter cards with toggle behavior matching requirements</done>
</task>

<task type="auto">
  <name>Add API support for media type filtering</name>
  <files>src/app/api/user/stats/route.ts</files>
  <action>
Check if /api/user/stats supports media type filtering. If not, add it:

1. Read src/app/api/user/stats/route.ts
2. Check if GET handler accepts media query parameter
3. If not, add: media?: 'movie' | 'tv' | 'cartoon' | 'anime'
4. Filter the typeBreakdown calculation based on media param
5. Update response to return filtered data when media is specified

The API should return:
- All data when no media param
- Only specified type data when media param present
  </action>
  <verify>
API accepts media query parameter and returns filtered data
  </verify>
  <done>API supports filtering by media type</done>
</task>

<task type="auto">
  <name>Connect filter to API and verify</name>
  <files>src/app/profile/stats/StatsClient.tsx</files>
  <action>
1. Update useEffect to include typeFilter in dependency array
2. When typeFilter changes, re-fetch /api/user/stats?media={typeFilter}
3. Or if client-side filtering is used, filter the displayed data
4. Run npm run lint to verify no errors
  </action>
  <verify>npm run lint passes</verify>
  <done>Lint passes with no errors</done>
</task>

</tasks>

<verification>
- [ ] Card labels match /profile (Фильмы, Сериалы, Мультфильмы, Аниме)
- [ ] Cards are buttons (not Links) with onClick handlers
- [ ] Click toggles filter correctly
- [ ] Page loads with all types showing
- [ ] Visual states: active (highlighted), inactive (dimmed)
- [ ] Filtered data displays correctly
</verification>

<success_criteria>
The /profile/stats page displays 4 interactive cards that filter stats by content type when clicked. Labels match /profile page. Toggle behavior works as specified.
</success_criteria>

<output>
After completion, create `.planning/phases/06-stats-page/06-02-SUMMARY.md`
</output>
